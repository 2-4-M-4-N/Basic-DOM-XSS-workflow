# DOM XSS workflow

DOM-based XSS হল একটা ক্লায়েন্ট-সাইড ভালনারাবিলিটি, যেখানে আক্রমণকারী URL বা অন্যান্য ক্লায়েন্ট-সাইড সোর্স (যেমন হ্যাশ # বা ওয়েবসাইটের কোনো ইনপুট ফিল্ডে) দিয়ে ম্যালিশিয়াস পেলোড ইনজেক্ট করে, এবং পেজের জাভাস্ক্রিপ্ট কোড সেটা স্যানিটাইজ না করে DOM-এ ইনসার্ট করে, যার ফলে স্ক্রিপ্ট এক্সিকিউট হয়ে ব্রাউজারে রেন্ডার করে।

নীচে একটা সিম্পল ডেমো দেখানো হলো, যা সাধারণ উদাহরণের উপর ভিত্তি করে (যেমন URL এর হ্যাশ থেকে ইনপুট নেয়া এবং document.write বা innerHTML দিয়ে DOM-এ ইনসার্ট করা)। এটা রিয়েল-ওয়ার্ল্ডের মতো, কিন্তু টেক্সট ভিত্তিক ভিজুয়াল ডেসক্রিপশন দিয়ে দেখানো হয়েছে।

### স্টেপ ১: ভালনারেবল কোড তৈরি (Vulnerable HTML/JS পেজ)

প্রথমে একটা সিম্পল HTML পেজ কল্পনা করুন, যেখানে URL-এর হ্যাশ (#) থেকে ইনপুট নেয় এবং সেটা DOM-এ ইনসার্ট করে। এটা ভালনারেবল কারণ ইনপুট স্যানিটাইজ করা হয়নি। নিচে url এর হ্যাশ (#) এর জন্য যেভাবে কোড করা হয়েছে তা দেখানো হলো:

```html
<!DOCTYPE html>
<html>
<head>
    <title>DOM XSS Demo</title>
</head>
<body>
    <h1>স্বাগতম! আপনার নাম লিখুন URL-এ (# এর পর)</h1>
    <div id="output"></div>
    <script>
        // ইনপুট সোর্স: URL হ্যাশ থেকে ডেটা নেয়া
        var userInput = window.location.hash.substring(1);  // # এর পরের অংশ নেয়
        
        // প্রসেসিং: ইনপুটকে DOM-এ ইনসার্ট করা (স্যানিটাইজ না করে)
        document.getElementById('output').innerHTML = "আপনার নাম: " + userInput;
    </script>
</body>
</html>
```

- **ইনপুট সোর্স**: window.location.hash (URL-এর # অংশ)।
- **সিঙ্ক (sink)** : innerHTML – এটা ইনপুটকে HTML Document হিসেবে ট্রিট করে DOM-এ ইনসার্ট করে।
- যদি URL হয় http://example.com/vulnerable-page.html#John, তাহলে পেজের কোডে <div id="output"> এ নিবে: "আপনার নাম: John"। ব্রাউজারে সাধারণ টেক্সট দেখা যাবে।

**ASCII ডায়াগ্রাম (পেজ স্ট্রাকচার):**

### স্টেপ ২: পেলোড তৈরি এবং ইনজেকশন (Payload Injection)

আক্রমণকারী একটা ম্যালিশিয়াস পেলোড তৈরি করে URL-এ ইনজেক্ট করে। এটা সাধারণত লিঙ্ক শেয়ার করে ভিকটিমকে ক্লিক করানো হয় (যেমন ইমেইল বা চ্যাটে)।

**পেলোড উদাহরণ**: <script>alert('XSS Hacked!')</script> (এটা একটা অ্যালার্ট বক্স দেখাবে)।

**ইনজেকশন কীভাবে?**

- URL-এ হ্যাশ (#) এর পর পেলোড যোগ করা: http://example.com/vulnerable-page.html#<script>alert('XSS Hacked!')</script>
- **কোথায় ইনজেক্ট হচ্ছে?** URL-এর ফ্র্যাগমেন্ট অংশে (# এর পর)। এটা সার্ভারে যায় না, সরাসরি ব্রাউজারে থাকে।
- **কীভাবে ইনজেক্ট হচ্ছে?** আক্রমণকারী লিঙ্ক তৈরি করে ভিকটিমকে পাঠায়। ভিকটিম ক্লিক করলে পেজ লোড হয় এবং JS কোড অটো রান করে।

**ভিজুয়ালি কেমন দেখাবে (URL বারে):**

```
ব্রাউজার URL: http://example.com/vulnerable-page.html#<script>alert('XSS Hacked!')</script>
```

### স্টেপ ৩: ইনজেকশনের পর ডেটা ফ্লো এবং প্রসেসিং (Data Flow and Processing)

- **ফ্লো শুরু**: ভিকটিম লিঙ্ক ক্লিক করলে পেজ লোড হয়। সার্ভার থেকে স্ট্যাটিক HTML আসে (কোনো পেলোড নেই)।
- সম্পূর্ণ ব্রাউজারে (ক্লায়েন্ট-সাইড)। Javascript কোডটা window.location.hash থেকে পেলোড পড়ে।
- JS ইউজার ইনপুট ভ্যারিয়েবলে পেলোড স্টোর করে, তারপর innerHTML দিয়ে DOM-এ ইনসার্ট করে। এখানে পেলোডটা HTML হিসেবে ইন্টারপ্রেট হয় কারণ স্যানিটাইজ নেই।
- **ডেটা ফ্লো ডায়াগ্রাম (ASCII):**

```
URL (#<script>alert('XSS')</script>) --> JS: window.location.hash --> userInput ভ্যারিয়েবল
                                             |
                                             v
innerHTML = "আপনার নাম: " + userInput --> DOM এ ইনসার্ট --> ব্রাউজার পার্স করে --> স্ক্রিপ্ট এক্সিকিউট
```

(নোট: মডার্ন ব্রাউজারে innerHTML সরাসরি <script> এক্সিকিউট না করতে পারে, তাই অল্টারনেটিভ পেলোড যেমন 
```
<img src="x" onerror="alert('XSS')"> ```
ব্যবহার করা যায়।)

### স্টেপ ৪: এক্সিকিউশন এবং আউটপুট (Execution and Output)

- ব্রাউজারের DOM-এ। পেলোড ইনসার্ট হওয়ার পর ব্রাউজার সেটা পার্স করে স্ক্রিপ্ট চালায়।
- <script> ট্যাগ এক্সিকিউট হয়, alert() ফাংশন কল হয়।
- একটা পপ-আপ অ্যালার্ট বক্স দেখা যাবে যাতে লেখা "XSS Hacked!"। পেজে কোনো ভিজিবল টেক্সট নাও দেখাতে পারে, কিন্তু অ্যালার্ট আসবে।
- অ্যালার্ট বক্সে মেসেজ, যা প্রমাণ করে XSS সফল। রিয়েল অ্যাটাকে এটা কুকি চুরি করতে পারে, যেমন alert(document.cookie)।

### স্টেপ ৫: পরবর্তী প্রভাব এবং মিটিগেশন (What Happens Next and Prevention)

- **প্রভাব**: আক্রমণকারী ভিকটিমের সেশন হাইজ্যাক করতে পারে, ডেটা চুরি করতে পারে।
- **ভিজুয়াল টেস্টিং**: ব্রাউজার ডেভ টুলস (F12) খুলে DOM ইন্সপেক্ট করুন – "Elements" ট্যাবে ইনজেক্টেড কোড দেখা যাবে। "Sources" ট্যাবে JS ডিবাগ করুন।
- **প্রতিরোধ**: ইনপুট স্যানিটাইজ করুন (যেমন DOMPurify লাইব্রেরি), innerHTML এর বদলে textContent ব্যবহার করুন।